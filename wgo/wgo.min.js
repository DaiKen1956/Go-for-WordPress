/*! MIT license, more info: wgo.waltheri.net */(function(D,u){var m=document.getElementsByTagName("script"),g={version:"2.01",B:1,W:-1,ERROR_REPORT:!0,DIR:m[m.length-1].src.split("?")[0].split("/").slice(0,-1).join("/")+"/",lang:"en",i18n:{en:{}}};g.opera=-1!=navigator.userAgent.search(/(opera)(?:.*version)?[ \/]([\w.]+)/i);g.webkit=-1!=navigator.userAgent.search(/(webkit)[ \/]([\w.]+)/i);g.msie=-1!=navigator.userAgent.search(/(msie) ([\w.]+)/i);g.mozilla=-1!=navigator.userAgent.search(/(mozilla)(?:.*? rv:([\w.]+))?/i)&&!g.webkit&&!g.msie;g.t=
function(a){var b=g.i18n[g.lang][a]||g.i18n.en[a];if(b){for(var c=1;c<arguments.length;c++)b=b.replace("$",arguments[c]);return b}return a};g.extendClass=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b;b.prototype.super=a;return b};g.abstractMethod=function(){throw Error("unimplemented abstract method");};g.clone=function(a){if(a&&"object"==typeof a){var b=a.constructor==Array?[]:{},c;for(c in a)b[c]=a[c]==a?a:g.clone(a[c]);return b}return a};g.filterHTML=function(a){return a&&
"string"==typeof a?a.replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};var h=function(a,b){b=b||{};for(var c in b)this[c]=b[c];for(c in g.Board.default)this[c]===u&&(this[c]=g.Board.default[c]);this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.init();a.appendChild(this.element);this.width&&this.height?this.setDimensions(this.width,this.height):this.width?this.setWidth(this.width):this.height&&this.setHeight(this.height)},
m={draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.beginPath();this.fillStyle="rgba(32,32,32,0.5)";this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill()}},p=function(a,b,c){return a.obj_arr[b][c][0].c==g.B?"rgba(255,255,255,0.8)":"rgba(0,0,0,0.8)"},C=function(a,b,c){return a.obj_arr[b][c][0]&&a.obj_arr[b][c][0].c==g.W||a.obj_arr[b][c][0].c==g.B},v,x=function(a){for(var b=a.angle,c=a.angle,e=0;e<a.lines.length;e++){var b=b+a.lines[e],c=c-a.lines[e],d=a.ctx,f=a.x,g=
a.y,k=a.radius,h=b,n=c,m=a.factor,l=a.thickness;d.strokeStyle="rgba(64,64,64,0.2)";d.lineWidth=k/30*l;d.beginPath();var k=k-Math.max(1,d.lineWidth),l=f+k*Math.cos(h*Math.PI),h=g+k*Math.sin(h*Math.PI),f=f+k*Math.cos(n*Math.PI),g=g+k*Math.sin(n*Math.PI),q=n=void 0,q=n=void 0;f>l?(n=(g-h)/(f-l),q=Math.atan(n)):f==l?q=Math.PI/2:(n=(g-h)/(f-l),q=Math.atan(n)-Math.PI);k*=m;n=Math.sin(q)*k;q=Math.cos(q)*k;k=l+n;m=h-q;n=f+n;q=g-q;d.moveTo(l,h);d.bezierCurveTo(k,m,n,q,f,g);d.stroke()}};h.drawHandlers={NORMAL:{stone:{draw:function(a,
b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius,f;a.c==g.W?(f=this.createRadialGradient(c-2*d/5,e-2*d/5,d/3,c-d/5,e-d/5,5*d/5),f.addColorStop(0,"#fff"),f.addColorStop(1,"#aaa")):(f=this.createRadialGradient(c-2*d/5,e-2*d/5,1,c-d/5,e-d/5,4*d/5),f.addColorStop(0,"#666"),f.addColorStop(1,"#000"));this.beginPath();this.fillStyle=f;this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill()}},shadow:m},PAINTED:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius,f;a.c==g.W?
(f=this.createRadialGradient(c-2*d/5,e-2*d/5,2,c-d/5,e-d/5,4*d/5),f.addColorStop(0,"#fff"),f.addColorStop(1,"#ddd")):(f=this.createRadialGradient(c-2*d/5,e-2*d/5,1,c-d/5,e-d/5,4*d/5),f.addColorStop(0,"#111"),f.addColorStop(1,"#000"));this.beginPath();this.fillStyle=f;this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill();this.beginPath();this.lineWidth=d/6;a.c==g.W?(this.strokeStyle="#999",this.arc(c+d/8,e+d/8,d/2,0,Math.PI/2,!1)):(this.strokeStyle="#ccc",this.arc(c-d/8,e-d/8,d/2,Math.PI,
1.5*Math.PI));this.stroke()}},shadow:m},GLOW:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius,f;a.c==g.W?(f=this.createRadialGradient(c-2*d/5,e-2*d/5,d/3,c-d/5,e-d/5,8*d/5),f.addColorStop(0,"#fff"),f.addColorStop(1,"#666")):(f=this.createRadialGradient(c-2*d/5,e-2*d/5,1,c-d/5,e-d/5,3*d/5),f.addColorStop(0,"#555"),f.addColorStop(1,"#000"));this.beginPath();this.fillStyle=f;this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill()}},shadow:m},SHELL:{stone:{draw:function(a,
b){var c,e,d=b.stoneRadius;v=v||Math.ceil(9999999*Math.random());c=b.getX(a.x);e=b.getY(a.y);var f;f=a.c==g.W?"#aaa":"#000";this.beginPath();this.fillStyle=f;this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill();if(a.c==g.W){f=v%(3+a.x*b.size+a.y)%3;var h=b.size*b.size+a.x*b.size+a.y,h=2/h*(v%h);0==f?x({ctx:this,x:c,y:e,radius:d,angle:h,lines:[.1,.12,.11,.1,.09,.09,.09,.09],factor:.25,thickness:1.75}):1==f?x({ctx:this,x:c,y:e,radius:d,angle:h,lines:[.1,.09,.08,.07,.06,.06,.06,.06,.06,.06,
.06],factor:.2,thickness:1.5}):x({ctx:this,x:c,y:e,radius:d,angle:h,lines:[.12,.14,.13,.12,.12,.12],factor:.3,thickness:2});f=this.createRadialGradient(c-2*d/5,e-2*d/5,d/3,c-d/5,e-d/5,5*d/5);f.addColorStop(0,"rgba(255,255,255,0.9)");f.addColorStop(1,"rgba(255,255,255,0)")}else f=this.createRadialGradient(c+.4*d,e+.4*d,0,c+.5*d,e+.5*d,d),f.addColorStop(0,"rgba(32,32,32,1)"),f.addColorStop(1,"rgba(0,0,0,0)"),this.beginPath(),this.fillStyle=f,this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0),this.fill(),
f=this.createRadialGradient(c-.4*d,e-.4*d,1,c-.5*d,e-.5*d,1.5*d),f.addColorStop(0,"rgba(64,64,64,1)"),f.addColorStop(1,"rgba(0,0,0,0)");this.beginPath();this.fillStyle=f;this.arc(c-.5,e-.5,Math.max(0,d-.5),0,2*Math.PI,!0);this.fill()}},shadow:m},MONO:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius,f=b.lineWidth||1;this.fillStyle=a.c==g.W?"white":"black";this.beginPath();this.arc(c,e,Math.max(0,d-f),0,2*Math.PI,!0);this.fill();this.lineWidth=f;this.strokeStyle="black";this.stroke()}}},
CR:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.strokeStyle=a.c||p(b,a.x,a.y);this.lineWidth=a.lineWidth||b.lineWidth||1;this.beginPath();this.arc(c-.5,e-.5,d/2,0,2*Math.PI,!0);this.stroke()}}},LB:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius,f=a.font||b.font||"";this.fillStyle=a.c||p(b,a.x,a.y);this.font=1==a.text.length?Math.round(1.5*d)+"px "+f:2==a.text.length?Math.round(1.2*d)+"px "+f:Math.round(d)+"px "+f;this.beginPath();this.textBaseline=
"middle";this.textAlign="center";this.fillText(a.text,c,e,2*d)}},grid:{draw:function(a,b){if(!C(b,a.x,a.y)&&!a._nodraw){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.clearRect(c-d,e-d,2*d,2*d)}},clear:function(a,b){if(!C(b,a.x,a.y)){a._nodraw=!0;var c;b.grid.clear();b.grid.draw(b);for(var e=0;e<b.size;e++)for(var d=0;d<b.size;d++)for(var f in b.obj_arr[e][d])c=b.obj_arr[e][d][f].type?"string"==typeof b.obj_arr[e][d][f].type?h.drawHandlers[b.obj_arr[e][d][f].type]:b.obj_arr[e][d][f].type:b.stoneHandler,
c.grid&&c.grid.draw.call(b.grid.context,b.obj_arr[e][d][f],b);for(f in b.obj_list)c=b.obj_list[f].handler,c.grid&&c.grid.draw.call(b.grid.context,b.obj_list[f].args,b);delete a._nodraw}}}},SQ:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=Math.round(b.stoneRadius);this.strokeStyle=a.c||p(b,a.x,a.y);this.lineWidth=a.lineWidth||b.lineWidth||1;this.beginPath();this.rect(Math.round(c-d/2)-.5,Math.round(e-d/2)-.5,d,d);this.stroke()}}},TR:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),
d=b.stoneRadius;this.strokeStyle=a.c||p(b,a.x,a.y);this.lineWidth=a.lineWidth||b.lineWidth||1;this.beginPath();this.moveTo(c-.5,e-.5-Math.round(d/2));this.lineTo(Math.round(c-d/2)-.5,Math.round(e+d/3)+.5);this.lineTo(Math.round(c+d/2)+.5,Math.round(e+d/3)+.5);this.closePath();this.stroke()}}},MA:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.strokeStyle=a.c||p(b,a.x,a.y);this.lineWidth=2*(a.lineWidth||b.lineWidth||1)-1;this.beginPath();this.moveTo(Math.round(c-d/2),
Math.round(e-d/2));this.lineTo(Math.round(c+d/2),Math.round(e+d/2));this.moveTo(Math.round(c+d/2)-1,Math.round(e-d/2));this.lineTo(Math.round(c-d/2)-1,Math.round(e+d/2));this.stroke()}}},SL:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.fillStyle=a.c||p(b,a.x,a.y);this.beginPath();this.rect(c-d/2,e-d/2,d,d);this.fill()}}},SM:{stone:{draw:function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.strokeStyle=a.c||p(b,a.x,a.y);this.lineWidth=2*(a.lineWidth||
b.lineWidth||1);this.beginPath();this.arc(c-d/3,e-d/3,d/6,0,2*Math.PI,!0);this.stroke();this.beginPath();this.arc(c+d/3,e-d/3,d/6,0,2*Math.PI,!0);this.stroke();this.beginPath();this.moveTo(c-d/1.5,e);this.bezierCurveTo(c-d/1.5,e+d/2,c+d/1.5,e+d/2,c+d/1.5,e);this.stroke()}}},outline:{stone:{draw:function(a,b){this.globalAlpha=a.alpha?a.alpha:.3;a.stoneStyle?h.drawHandlers[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b);this.globalAlpha=1}}},mini:{stone:{draw:function(a,
b){b.stoneRadius/=2;a.stoneStyle?h.drawHandlers[a.stoneStyle].stone.draw.call(this,a,b):b.stoneHandler.stone.draw.call(this,a,b);b.stoneRadius*=2}}}};h.coordinates={grid:{draw:function(a,b){var c,e,d,f,g,h;this.fillStyle="rgba(0,0,0,0.7)";this.textBaseline="middle";this.textAlign="center";this.font=b.stoneRadius+"px "+(b.font||"");d=b.getX(-.75);f=b.getX(b.size-.25);g=b.getY(-.75);h=b.getY(b.size-.25);for(var l=0;l<b.size;l++)c=l+65,73<=c&&c++,e=b.getY(l),this.fillText(b.size-l,d,e),this.fillText(b.size-
l,f,e),e=b.getX(l),this.fillText(String.fromCharCode(c),e,g),this.fillText(String.fromCharCode(c),e,h);this.fillStyle="black"}}};h.CanvasLayer=function(){this.element=document.createElement("canvas");this.context=this.element.getContext("2d")};h.CanvasLayer.prototype={constructor:h.CanvasLayer,setDimensions:function(a,b){this.element.width=a;this.element.height=b},draw:function(a){},clear:function(){this.context.clearRect(0,0,this.element.width,this.element.height)}};h.GridLayer=g.extendClass(h.CanvasLayer,
function(){this.super.call(this)});h.GridLayer.prototype.draw=function(a){var b;this.context.beginPath();this.context.lineWidth=1;this.context.strokeStyle="rgba(0,0,0,"+Math.min(1,a.stoneRadius/15)+")";var c=Math.round(a.left),e=Math.round(a.top),d=Math.round(a.fieldWidth*(a.size-1)),f=Math.round(a.fieldHeight*(a.size-1));this.context.strokeRect(c-.5,e-.5,d,f);for(var g=1;g<a.size-1;g++)b=Math.round(a.getX(g))-.5,this.context.moveTo(b,e),this.context.lineTo(b,e+f),b=Math.round(a.getY(g))-.5,this.context.moveTo(c,
b),this.context.lineTo(c+d,b);this.context.stroke();this.context.fillStyle="#000";if(a.starPoints[a.size])for(var h in a.starPoints[a.size])this.context.beginPath(),this.context.arc(a.getX(a.starPoints[a.size][h].x)-.5,a.getY(a.starPoints[a.size][h].y)-.5,a.starSize*(a.width/300+1),0,2*Math.PI,!0),this.context.fill()};h.ShadowLayer=g.extendClass(h.CanvasLayer,function(a){this.super.call(this);this.shadowSize=a===u?1:a});h.ShadowLayer.prototype.setDimensions=function(a,b){this.super.prototype.setDimensions.call(this,
a,b);this.context.setTransform(1,0,0,1,Math.round(this.shadowSize*a/300),Math.round(this.shadowSize*b/300))};var E=function(a,b){var c=b.getX(a.x),e=b.getY(a.y),d=b.stoneRadius;this.clearRect(c-d-.5,e-d-.5,2*d,2*d);this.clearRect(c-d-.5,e-d-.5,2*d,2*d)},y=function(){return 3*this.width/(4*(this.bx+1-this.tx)+2)-this.fieldWidth*this.tx},z=function(){return 3*this.height/(4*(this.by+1-this.ty)+2)-this.fieldHeight*this.ty},A=function(a,b){var c,e;for(e in this.obj_arr[a][b]){c=this.obj_arr[a][b][e].type?
"string"==typeof this.obj_arr[a][b][e].type?h.drawHandlers[this.obj_arr[a][b][e].type]:this.obj_arr[a][b][e].type:this.stoneHandler;for(var d in c)c[d].clear?c[d].clear.call(this[d].context,this.obj_arr[a][b][e],this):E.call(this[d].context,this.obj_arr[a][b][e],this)}},w=function(a,b){var c,e;for(e in this.obj_arr[a][b]){c=this.obj_arr[a][b][e].type?"string"==typeof this.obj_arr[a][b][e].type?h.drawHandlers[this.obj_arr[a][b][e].type]:this.obj_arr[a][b][e].type:this.stoneHandler;for(var d in c)c[d].draw.call(this[d].context,
this.obj_arr[a][b][e],this)}},F=function(a){for(var b=0,c=0,e=this.grid.element;e&&"BODY"!=e.tagName;)b+=e.offsetTop,c+=e.offsetLeft,e=e.offsetParent;c=Math.round((a.pageX-c-this.left)/this.fieldWidth);a=Math.round((a.pageY-b-this.top)/this.fieldHeight);return{x:c>=this.size?-1:c,y:a>=this.size?-1:a}},B=function(){this.element.style.width=this.width+"px";this.element.style.height=this.height+"px";this.stoneRadius=this.stoneSize*Math.min(this.fieldWidth,this.fieldHeight)/2;this.autoLineWidth&&(this.lineWidth=
this.stoneRadius/7);for(var a in this.layers)this.layers[a].setDimensions(this.width,this.height)};h.prototype={constructor:h,init:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.obj_list=[];this.layers=[];this.listeners=[];this.element=document.createElement("div");this.element.className="wgo-board";this.background&&("#"==this.background[0]?this.element.style.backgroundColor=this.background:this.element.style.backgroundImage=
"url('"+this.background+"')");this.grid=new h.GridLayer;this.shadow=new h.ShadowLayer(this.shadowSize);this.stone=new h.CanvasLayer;this.addLayer(this.grid,100);this.addLayer(this.shadow,200);this.addLayer(this.stone,300)},setWidth:function(a){this.width=a;this.fieldHeight=this.fieldWidth=4*this.width/(4*(this.bx+1-this.tx)+2);this.left=y.call(this);this.height=(this.by-this.ty+1.5)*this.fieldHeight;this.top=z.call(this);B.call(this);this.redraw()},setHeight:function(a){this.height=a;this.fieldWidth=
this.fieldHeight=4*this.height/(4*(this.by+1-this.ty)+2);this.top=z.call(this);this.width=(this.bx-this.tx+1.5)*this.fieldWidth;this.left=y.call(this);B.call(this);this.redraw()},setDimensions:function(a,b){this.width=a||this.width;this.height=b||this.height;this.fieldWidth=4*this.width/(4*(this.bx+1-this.tx)+2);this.fieldHeight=4*this.height/(4*(this.by+1-this.ty)+2);this.left=y.call(this);this.top=z.call(this);B.call(this);this.redraw()},getSection:function(){return this.section},setSection:function(a,
b,c,e){this.section="object"==typeof a?a:{top:a,right:b,bottom:c,left:e};this.tx=this.section.left;this.ty=this.section.top;this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()},setSize:function(a){a=a||19;if(a!=this.size){this.size=a;this.obj_arr=[];for(a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.bx=this.size-1-this.section.right;this.by=this.size-1-this.section.bottom;this.setDimensions()}},redraw:function(){for(var a=
0;a<this.layers.length;a++)this.layers[a].clear(this),this.layers[a].draw(this);for(a=0;a<this.size;a++)for(var b=0;b<this.size;b++)w.call(this,a,b);for(var c in this.obj_list){var a=this.obj_list[c].handler,e;for(e in a)a[e].draw.call(this[e].context,this.obj_list[c].args,this)}},getX:function(a){return this.left+a*this.fieldWidth},getY:function(a){return this.top+a*this.fieldHeight},addLayer:function(a,b){a.element.style.position="absolute";a.element.style.zIndex=b;a.setDimensions(this.width,this.height);
this.element.appendChild(a.element);this.layers.push(a)},removeLayer:function(a){var b=this.layers.indexOf(a);0<=b&&(this.layers.splice(b,1),this.element.removeChild(a.element))},update:function(a){if(a.remove&&"all"==a.remove)this.removeAllObjects();else if(a.remove)for(var b in a.remove)this.removeObject(a.remove[b]);if(a.add)for(b in a.add)this.addObject(a.add[b])},addObject:function(a){if(a.constructor==Array)for(var b in a)this.addObject(a[b]);else{A.call(this,a.x,a.y);for(b in this.obj_arr[a.x][a.y])if(this.obj_arr[a.x][a.y][b].type==
a.type){this.obj_arr[a.x][a.y][b]=a;w.call(this,a.x,a.y);return}a.type?this.obj_arr[a.x][a.y].push(a):this.obj_arr[a.x][a.y].unshift(a);w.call(this,a.x,a.y)}},removeObject:function(a){if(a.constructor==Array)for(var b in a)this.removeObject(a[b]);else{var c;for(b=0;b<this.obj_arr[a.x][a.y].length;b++)if(this.obj_arr[a.x][a.y][b].type==a.type){c=b;break}c!==u&&(A.call(this,a.x,a.y),this.obj_arr[a.x][a.y].splice(c,1),w.call(this,a.x,a.y))}},removeObjectsAt:function(a,b){this.obj_arr[a][b].length&&(A.call(this,
a,b),this.obj_arr[a][b]=[])},removeAllObjects:function(){this.obj_arr=[];for(var a=0;a<this.size;a++){this.obj_arr[a]=[];for(var b=0;b<this.size;b++)this.obj_arr[a][b]=[]}this.redraw()},addCustomObject:function(a,b){this.obj_list.push({handler:a,args:b});this.redraw()},removeCustomObject:function(a,b){for(var c in this.obj_list)if(this.obj_list[c].handler==a&&this.obj_list[c].args==b)return delete this.obj_list[c],this.redraw(),!0;return!1},addEventListener:function(a,b){var c=this,e={type:a,callback:b,
handleEvent:function(a){var e=F.call(c,a);b(e.x,e.y,a)}};this.element.addEventListener(a,e,!0);this.listeners.push(e)},removeEventListener:function(a,b){for(var c in this.listeners)if(this.listeners[c].type==a&&this.listeners[c].callback==b)return this.element.removeEventListener(this.listeners[c].type,this.listeners[c],!0),delete this.listeners[c],!0;return!1},getState:function(){return{objects:g.clone(this.obj_arr),custom:g.clone(this.obj_list)}},restoreState:function(a){this.obj_arr=a.objects||
this.obj_arr;this.obj_list=a.custom||this.obj_list;this.redraw()}};h.default={size:19,width:0,height:0,font:"Calibri",lineWidth:1,autoLineWidth:!1,starPoints:{19:[{x:3,y:3},{x:9,y:3},{x:15,y:3},{x:3,y:9},{x:9,y:9},{x:15,y:9},{x:3,y:15},{x:9,y:15},{x:15,y:15}],13:[{x:3,y:3},{x:9,y:3},{x:3,y:9},{x:9,y:9}],9:[{x:4,y:4}]},stoneHandler:h.drawHandlers.NORMAL,starSize:1,shadowSize:1,stoneSize:1,section:{top:0,right:0,bottom:0,left:0},background:g.DIR+"wood1.jpg"};g.Board=h;var r=function(a){this.size=a||
19;this.schema=[];for(a=0;a<this.size*this.size;a++)this.schema[a]=0};r.prototype={constructor:g.Position,get:function(a,b){return 0>a||0>b||a>=this.size||b>=this.size?u:this.schema[a*this.size+b]},set:function(a,b,c){this.schema[a*this.size+b]=c;return this},clear:function(){for(var a=0;a<this.size*this.size;a++)this.schema[a]=0;return this},clone:function(){var a=new r(this.size);a.schema=this.schema.slice(0);return a},compare:function(a){for(var b=[],c=[],e=0;e<this.size*this.size;e++)this.schema[e]&&
!a.schema[e]?c.push({x:Math.floor(e/this.size),y:e%this.size}):this.schema[e]!=a.schema[e]&&b.push({x:Math.floor(e/this.size),y:e%this.size,c:a.schema[e]});return{add:b,remove:c}}};g.Position=r;var m=function(a,b,c,e){this.size=a||19;this.repeating=b===u?"KO":b;this.allow_rewrite=c||!1;this.allow_suicide=e||!1;this.stack=[];this.stack[0]=new r(this.size);this.stack[0].capCount={black:0,white:0};this.turn=g.B;Object.defineProperty(this,"position",{get:function(){return this.stack[this.stack.length-
1]},set:function(a){this[this.stack.length-1]=a}})},s=function(a,b,c,e,d){0<=c&&c<a.size&&0<=e&&e<a.size&&a.get(c,e)==d&&(a.set(c,e,0),b.push({x:c,y:e}),s(a,b,c,e-1,d),s(a,b,c,e+1,d),s(a,b,c-1,e,d),s(a,b,c+1,e,d))},t=function(a,b,c,e,d){if(0>c||c>=a.size||0>e||e>=a.size)return!0;if(0==a.get(c,e))return!1;if(!0==b.get(c,e)||a.get(c,e)==-d)return!0;b.set(c,e,!0);return t(a,b,c,e-1,d)&&t(a,b,c,e+1,d)&&t(a,b,c-1,e,d)&&t(a,b,c+1,e,d)},l=function(a,b,c,e){var d=[];if(0<=b&&b<a.size&&0<=c&&c<a.size&&a.get(b,
c)==e){var f=new r(a.size);t(a,f,b,c,e)&&s(a,d,b,c,e)}return d};m.prototype={constructor:m,getPosition:function(){return this.stack[this.stack.length-1]},play:function(a,b,c,e){if(!this.isOnBoard(a,b))return 1;if(!this.allow_rewrite&&0!=this.position.get(a,b))return 2;c||(c=this.turn);var d=this.position.clone();d.set(a,b,c);var f=c,h=l(d,a-1,b,-c).concat(l(d,a+1,b,-c),l(d,a,b-1,-c),l(d,a,b+1,-c));if(!h.length){var k=new r(this.size);if(t(d,k,a,b,c))if(this.allow_suicide)f=-c,s(d,h,a,b,c);else return 3}if(k=
this.repeating){a:{var m;if("KO"==this.repeating&&0<=this.stack.length-2)m=this.stack.length-2;else if("ALL"==this.repeating)m=0;else{a=!0;break a}for(var n=this.stack.length-2;n>=m;n--)if(this.stack[n].get(a,b)==d.get(a,b)){for(var k=!0,p=0;p<this.size*this.size;p++)if(this.stack[n].schema[p]!=d.schema[p]){k=!1;break}if(k){a=!1;break a}}a=!0}k=!a}if(k)return 4;if(e)return!1;d.color=c;d.capCount={black:this.position.capCount.black,white:this.position.capCount.white};f==g.B?d.capCount.black+=h.length:
d.capCount.white+=h.length;this.pushPosition(d);this.turn=-c;return h},pass:function(a){this.pushPosition();a?(this.position.color=a,this.turn=-a):(this.position.color=this.turn,this.turn=-this.turn)},isValid:function(a,b,c){return"number"!=typeof this.play(a,b,c,!0)},isOnBoard:function(a,b){return 0<=a&&0<=b&&a<this.size&&b<this.size},addStone:function(a,b,c){return this.isOnBoard(a,b)&&0==this.position.get(a,b)?(this.position.set(a,b,c||0),!0):!1},removeStone:function(a,b){return this.isOnBoard(a,
b)&&0!=this.position.get(a,b)?(this.position.set(a,b,0),!0):!1},setStone:function(a,b,c){return this.isOnBoard(a,b)?(this.position.set(a,b,c||0),!0):!1},getStone:function(a,b){return this.isOnBoard(a,b)?this.position.get(a,b):0},pushPosition:function(a){a||(a=this.position.clone(),a.capCount={black:this.position.capCount.black,white:this.position.capCount.white},a.color=this.position.color);this.stack.push(a);a.color&&(this.turn=-a.color);return this},popPosition:function(){var a=null;0<this.stack.length&&
(a=this.stack.pop(),this.turn=0==this.stack.length?g.B:this.position.color?-this.position.color:-this.turn);return a},firstPosition:function(){this.stack=[];this.stack[0]=new r(this.size);this.stack[0].capCount={black:0,white:0};this.turn=g.B;return this},getCaptureCount:function(a){return a==g.B?this.position.capCount.black:this.position.capCount.white},validatePosition:function(){for(var a,b,c=0,e=0,d=[],f=this.position.clone(),h=0;h<this.size;h++)for(var k=0;k<this.size;k++)if(a=this.position.get(h,
k))b=d.length,d=d.concat(l(f,h-1,k,-a),l(f,h+1,k,-a),l(f,h,k-1,-a),l(f,h,k+1,-a)),a==g.B?e+=d-b:c+=d-b;this.position.capCount.black+=e;this.position.capCount.white+=c;this.position.schema=f.schema;return d}};g.Game=m;D.WGo=g})(window);

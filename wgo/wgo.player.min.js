/*! MIT license, more info: wgo.waltheri.net */(function(c,n){var h=function(a){var b=new k(JSON.parse(JSON.stringify(a.getProperties()))),l;for(l in a.children)b.appendChild(h(a.children[l]));return b},g=function(a,b){var l;if(b[a]!==n)return b[a];for(var f in b.children)if(l=g(a,b.children[f]))return l;return!1},m=function(a,b){a.push(JSON.parse(JSON.stringify(b.getProperties())));if(1<b.children.length){for(var l=[],f=0;f<b.children.length;f++){var d=[];m(d,b.children[f]);l.push(d)}a.push(l)}else b.children.length&&m(a,b.children[0])},d=function(a,
b){for(var l=b,f,c=1;c<a.length;c++)if(a[c].constructor==Array)for(var e=0;e<a[c].length;e++)f=new k(a[c][e][0]),l.appendChild(f),d(a[c][e],f);else f=new k(a[c]),l.insertAfter(f),l=f},e=function(){this.size=19;this.info={};this.root=new k;this.propertyCount=this.nodeCount=0};e.prototype={constructor:e,clone:function(){var a=new e;a.size=this.size;a.info=JSON.parse(JSON.stringify(this.info));a.root=h(this.root);a.nodeCount=this.nodeCount;a.propertyCount=this.propertyCount;return a},hasComments:function(){return!!g("comment",
this.root)}};e.fromSgf=function(a){return c.SGF.parse(a)};e.fromJGO=function(a){a="string"==typeof a?JSON.parse(a):a;var b=new e;b.info=JSON.parse(JSON.stringify(a.info));b.size=a.size;b.nodeCount=a.nodeCount;b.propertyCount=a.propertyCount;b.root=new k(a.game[0]);d(a.game,b.root);return b};e.prototype.toSgf=function(){};e.prototype.toJGO=function(a){var b={};b.size=this.size;b.info=JSON.parse(JSON.stringify(this.info));b.nodeCount=this.nodeCount;b.propertyCount=this.propertyCount;b.game=[];m(b.game,
this.root);return a?JSON.stringify(b):b};var a=function(a){var b;a.name?(b=c.filterHTML(a.name),a.rank&&(b+=" ("+c.filterHTML(a.rank)+")"),a.team&&(b+=", "+c.filterHTML(a.team))):(a.team&&(b=c.filterHTML(a.team)),a.rank&&(b+=" ("+c.filterHTML(a.rank)+")"));return b};e.infoFormatters={black:a,white:a,TM:function(a){if(0==a)return c.t("none");var b,l=Math.floor(a/60);1==l?b="1 "+c.t("minute"):1<l&&(b=l+" "+c.t("minutes"));l=a%60;1==l?b+=" 1 "+c.t("second"):1<l&&(b+=" "+l+" "+c.t("seconds"));return b},
RE:function(a){return'<a href="javascript: void(0)" onclick="this.parentNode.innerHTML = \''+c.filterHTML(a)+'\'" title="'+c.t("res-show-tip")+'">'+c.t("show")+"</a>"}};e.infoList="black white AN CP DT EV GN GC HA ON OT RE RO RU SO TM US PC KM".split(" ");c.Kifu=e;var b=function(a,b,l){for(var f=0;f<a.length;f++)if(a[f].x==b.x&&a[f].y==b.y){a[f][l]=b[l];return}a.push(b)},p=function(a,b){a||remove;for(var l=0;l<a.length;l++)if(a[l].x==b.x&&a[l].y==b.y){a.splice(l,1);break}},k=function(a,b){this.parent=
b||null;this.children=[];if(a)for(var l in a)this[l]=a[l]};k.prototype={constructor:k,getChild:function(a){a=a||0;return this.children[a]?this.children[a]:null},addSetup:function(a){this.setup=this.setup||[];b(this.setup,a,"c");return this},removeSetup:function(a){p(this.setup,a);return this},addMarkup:function(a){this.markup=this.markup||[];b(this.markup,a,"type");return this},removeMarkup:function(a){p(this.markup,a);return this},remove:function(){var a=this.parent;if(!a)throw new Exception("Root node cannot be removed");
for(var b in a.children)if(a.children[b]==this){a.children.splice(b,1);break}a.children=a.children.concat(this.children);this.parent=null;return a},insertAfter:function(a){for(var b in this.children)this.children[b].parent=a;a.children=a.children.concat(this.children);a.parent=this;this.children=[a];return a},appendChild:function(a){a.parent=this;this.children.push(a);return a},getProperties:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&"children"!=b&&"parent"!=b&&(a[b]=this[b]);return a}};
c.KNode=k;var f=function(a,b){for(var l=a.size,f=[],d=[],c=0;c<l*l;c++)a.schema[c]&&!b.schema[c]?d.push({x:Math.floor(c/l),y:c%l}):a.schema[c]!=b.schema[c]&&f.push({x:Math.floor(c/l),y:c%l,c:b.schema[c]});return{add:f,remove:d}},a=function(a,b,f){this.kifu=a;this.node=this.kifu.root;this.allow_illegal=f||!1;this.game=new c.Game(this.kifu.size,this.allow_illegal?"NONE":"KO",this.allow_illegal,this.allow_illegal);this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=c.W);this.change=
l(this.game,this.node,!0);this.rememberPath=b?!0:!1},q=function(a,b){var l=[],f,c;for(c in a){f=!0;for(var d in b)if(a[c].x==b[d].x&&a[c].y==b[d].y){f=!1;break}f&&l.push(a[c])}return l},l=function(a,b,l){b.parent&&(b.parent._last_selected=b.parent.children.indexOf(b));if(b.move!=n){if(b.move.pass)return a.pass(b.move.c),{add:[],remove:[]};a=a.play(b.move.x,b.move.y,b.move.c);if("number"==typeof a)throw new u(a,b);for(var f in a)if(a[f].x==b.move.x&&a[f].y==b.move.y)return{add:[],remove:a};return{add:[b.move],
remove:a}}l||a.pushPosition();l=[];var c=[];if(b.setup!=n)for(f in b.setup)b.setup[f].c?(a.setStone(b.setup[f].x,b.setup[f].y,b.setup[f].c),l.push(b.setup[f])):(a.removeStone(b.setup[f].x,b.setup[f].y),c.push(b.setup[f]));b.turn&&(a.turn=b.turn);return{add:l,remove:c}},r=function(a){a===n&&this.rememberPath&&(a=this.node._last_selected);a=a||0;var b=this.node.children[a];if(!b)return!1;var f=l(this.game,b);this.path.m++;1<this.node.children.length&&(this.path[this.path.m]=a);this.node=b;return f},
v=function(){if(!this.node.parent)return!1;this.node=this.node.parent;this.game.popPosition();this.node.turn&&(this.game.turn=this.node.turn);this.path[this.path.m]!==n&&delete this.path[this.path.m];this.path.m--;return!0},w=function(){this.game.firstPosition();this.node=this.kifu.root;this.path={m:0};this.kifu.info.HA&&1<this.kifu.info.HA&&(this.game.turn=c.W);this.change=l(this.game,this.node,!0)};a.prototype={constructor:a,next:function(a){this.change=r.call(this,a);return this},last:function(){var a;
for(this.change={add:[],remove:[]};a=r.call(this);){var b=this.change;b.add=q(b.add,a.remove).concat(a.add);b.remove=q(b.remove,a.add).concat(a.remove)}return this},previous:function(){var a=this.game.getPosition();v.call(this);this.change=f(a,this.game.getPosition());return this},first:function(){var a=this.game.getPosition();w.call(this);this.change=f(a,this.game.getPosition());return this},goTo:function(a){if(a===n)return this;var b=this.game.getPosition();w.call(this);for(var l=0;l<a.m&&r.call(this,
a[l+1]);l++);this.change=f(b,this.game.getPosition());return this},previousFork:function(){for(var a=this.game.getPosition();v.call(this)&&1==this.node.children.length;);this.change=f(a,this.game.getPosition());return this},getPosition:function(){return this.game.getPosition()},allowIllegalMoves:function(a){a?(this.game.allow_rewrite=!0,this.game.allow_suicide=!0,this.repeating="NONE"):(this.game.allow_rewrite=!1,this.game.allow_suicide=!1,this.repeating="KO")}};c.KifuReader=a;var u=function(a,b){this.name=
"InvalidMoveError";this.message="Invalid move in kifu detected. ";if(b.move&&b.move.c!==n&&b.move.x!==n&&b.move.y!==n){var l=b.move.x;7<b.move.x&&l++;String.fromCharCode(l+65);this.message+="Trying to play "+(b.move.c==c.WHITE?"white":"black")+" move on "+String.fromCharCode(b.move.x+65)+""+(19-b.move.y)}else this.message+="Move object doesn't contain arbitrary attributes.";if(a)switch(a){case 1:this.message+=", but these coordinates are not on board.";break;case 2:this.message+=", but there already is a stone.";
break;case 3:this.message+=", but this move is a suicide.";break;case 4:this.message+=", but this position already occured."}else this.message+="."};u.prototype=Error();u.prototype.constructor=u;c.InvalidMoveError=u;c.i18n.en.show="show";c.i18n.en["res-show-tip"]="Click to show result."})(WGo);(function(c,n){c.SGF={};var h=function(a,c,d,f,e,l){c=l==c?"black":"white";d.info[c]=d.info[c]||{};d.info[c][a]=e[0]},g=c.SGF.properties={};g.B=g.W=function(a,d,e,f){d.move=!e[0]||19>=a.size&&"tt"==e[0]?{pass:!0,c:"B"==f?c.B:c.W}:{x:e[0].charCodeAt(0)-97,y:e[0].charCodeAt(1)-97,c:"B"==f?c.B:c.W}};g.AB=g.AW=function(a,d,e,f){for(var g in e)d.addSetup({x:e[g].charCodeAt(0)-97,y:e[g].charCodeAt(1)-97,c:"AB"==f?c.B:c.W})};g.AE=function(a,c,d){for(var f in d)c.addSetup({x:d[f].charCodeAt(0)-97,y:d[f].charCodeAt(1)-
97})};g.PL=function(a,d,e){d.turn="b"==e[0]||"B"==e[0]?c.B:c.W};g.C=function(a,c,d){c.comment=d.join()};g.LB=function(a,c,d){for(var f in d)c.addMarkup({x:d[f].charCodeAt(0)-97,y:d[f].charCodeAt(1)-97,type:"LB",text:d[f].substr(3)})};g.CR=g.SQ=g.TR=g.SL=g.MA=function(a,c,d,f){for(var e in d)c.addMarkup({x:d[e].charCodeAt(0)-97,y:d[e].charCodeAt(1)-97,type:f})};g.SZ=function(a,c,d){a.size=parseInt(d[0])};g.BR=g.WR=h.bind(this,"rank","BR");g.PB=g.PW=h.bind(this,"name","PB");g.BT=g.WT=h.bind(this,"team",
"BT");g.TM=function(a,d,c,f){a.info[f]=c[0];d.BL=c[0];d.WL=c[0]};var m=/\(|\)|(;(\s*[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+)*)/g,d=/[A-Z]+\s*((\[\])|(\[(.|\s)*?([^\\]\])))+/g,e=/[A-Z]+/,a=/(\[\])|(\[(.|\s)*?([^\\]\]))/g;c.SGF.parse=function(b){var g=[],k,f,q,l=new c.Kifu,r=null;b=b.match(m);for(var h in b)if("("==b[h])g.push(r);else if(")"==b[h])r=g.pop();else{r&&l.nodeCount++;r=r?r.appendChild(new c.KNode):l.root;k=b[h].match(d)||[];l.propertyCount+=k.length;for(var n in k){q=e.exec(k[n])[0];f=
k[n].match(a);for(var u in f)f[u]=f[u].substring(1,f[u].length-1).replace(/\\(?!\\)/g,"");if(c.SGF.properties[q])c.SGF.properties[q](l,r,f,q);else 1>=f.length&&(f=f[0]),r.parent?r[q]=f:l.info[q]=f}}return l}})(WGo);(function(c){var n=function(a,b){this.name="FileError";this.message=1==b?"File '"+a+"' is empty.":2==b?"Network error. It is not possible to read '"+a+"'.":"File '"+a+"' hasn't been found on server."};n.prototype=Error();n.prototype.constructor=n;c.FileError=n;var h=c.loadFromUrl=function(a,b){var f=new XMLHttpRequest;f.onreadystatechange=function(){if(4==f.readyState)if(200==f.status){if(0==f.responseText.length)throw new n(a,1);b(f.responseText)}else throw new n(a);};try{f.open("GET",a,!0),f.send()}catch(c){throw new n(a,
2);}},g=function(a){a.change&&this.board.update(a.change);this.temp_marks&&this.board.removeObject(this.temp_marks);var b=[];this.notification();a.node.move&&this.config.markLastMove&&(a.node.move.pass?this.notification(c.t((a.node.move.c==c.B?"b":"w")+"pass")):b.push({type:"CR",x:a.node.move.x,y:a.node.move.y}));if(1<a.node.children.length)for(var f=0;f<a.node.children.length;f++)a.node.children[f].move&&!a.node.children[f].move.pass&&b.push({type:"LB",text:String.fromCharCode(65+f),x:a.node.children[f].move.x,
y:a.node.children[f].move.y,c:"rgba(0,32,128,0.8)"});if(a.node.markup){for(f in a.node.markup)for(var d=0;d<b.length;d++)a.node.markup[f].x==b[d].x&&a.node.markup[f].y==b[d].y&&(b.splice(d,1),d--);b=b.concat(a.node.markup)}this.temp_marks=b;this.board.addObject(b)},m=function(a){this.board.setSize(a.kifu.size);this.board.removeAllObjects();this.config.enableWheel&&this.setWheel(!0)},d=function(a,b){return a==b.element||a==b.element?!1:a._wgo_scrollable||a.scrollHeight>a.offsetHeight?!0:d(a.parentNode,
b)},e=function(a){var b=a.wheelDelta||-1*a.detail;return d(a.target,this)?!0:0>b?(this.next(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):0<b?(this.previous(),this.config.lockScroll&&a.preventDefault&&a.preventDefault(),!this.config.lockScroll):!0},a=function(a){if(document.querySelector(":focus"))return!0;switch(a.keyCode){case 39:this.next();break;case 37:this.previous();break;default:return!0}this.config.lockScroll&&a.preventDefault&&a.preventDefault();
return!this.config.lockScroll},b=function(a,b){if(!this.kifuReader||!this.kifuReader.node)return!1;for(var f in this.kifuReader.node.children)if(this.kifuReader.node.children[f].move&&this.kifuReader.node.children[f].move.x==a&&this.kifuReader.node.children[f].move.y==b){this.next(f);break}},p={grid:{draw:function(a,b){var f,d,c,e,g,p;this.fillStyle="rgba(0,0,0,0.7)";this.textBaseline="middle";this.textAlign="center";this.font=b.stoneRadius+"px "+(b.font||"");c=b.getX(-.75);e=b.getX(b.size-.25);g=
b.getY(-.75);p=b.getY(b.size-.25);for(var k=0;k<b.size;k++)f=k+65,73<=f&&f++,d=b.getY(k),this.fillText(b.size-k,c,d),this.fillText(b.size-k,e,d),d=b.getX(k),this.fillText(String.fromCharCode(f),d,g),this.fillText(String.fromCharCode(f),d,p);this.fillStyle="black"}}},k=function(a){this.config=a;for(var b in k.default)void 0===this.config[b]&&void 0!==k.default[b]&&(this.config[b]=k.default[b]);this.element=document.createElement("div");this.board=new c.Board(this.element,this.config.board);this.init();
this.initGame()};k.prototype={constructor:k,init:function(){this.kifu=null;this.listeners={kifuLoaded:[m.bind(this)],update:[g.bind(this)],frozen:[],unfrozen:[]};this.config.kifuLoaded&&this.addEventListener("kifuLoaded",this.config.kifuLoaded);this.config.update&&this.addEventListener("update",this.config.update);this.config.frozen&&this.addEventListener("frozen",this.config.frozen);this.config.unfrozen&&this.addEventListener("unfrozen",this.config.unfrozen);this.board.addEventListener("click",b.bind(this));
this.element.addEventListener("click",this.focus.bind(this));this.focus()},initGame:function(){this.config.sgf?this.loadSgf(this.config.sgf,this.config.move):this.config.json?this.loadJSON(this.config.json,this.config.move):this.config.sgfFile&&this.loadSgfFromFile(this.config.sgfFile,this.config.move)},update:function(a){this.kifuReader&&this.kifuReader.change&&(a={type:"update",op:a,target:this,node:this.kifuReader.node,position:this.kifuReader.getPosition(),path:this.kifuReader.path,change:this.kifuReader.change},
this.dispatchEvent(a))},loadKifu:function(a,b){this.kifu=a;this.kifuReader=new c.KifuReader(this.kifu,this.config.rememberPath,this.config.allowIllegalMoves);this.dispatchEvent({type:"kifuLoaded",target:this,kifu:this.kifu});this.update("init");b&&this.goTo(b)},loadSgf:function(a,b){try{this.loadKifu(c.Kifu.fromSgf(a),b)}catch(f){this.error(f)}},loadJSON:function(a){try{this.loadKifu(c.Kifu.fromJGO(a),path)}catch(b){this.error(b)}},loadSgfFromFile:function(a,b){var f=this;try{h(a,function(a){f.loadSgf(a,
b)})}catch(d){this.error(d)}},addEventListener:function(a,b){this.listeners[a]=this.listeners[a]||[];this.listeners[a].push(b)},removeEventListener:function(a,b){if(this.listeners[a]){var f=this.listeners[a].indexOf(b);-1!=f&&this.listeners[a].splice(f,1)}},dispatchEvent:function(a){if(this.listeners[a.type])for(var b in this.listeners[a.type])this.listeners[a.type][b](a)},notification:function(a){console&&console.log(a)},help:function(a){console&&console.log(a)},error:function(a){if(!c.ERROR_REPORT)throw a;
console&&console.log(a)},next:function(a){if(!this.frozen&&this.kifu)try{this.kifuReader.next(a),this.update()}catch(b){this.error(b)}},previous:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.previous(),this.update()}catch(a){this.error(a)}},last:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.last(),this.update()}catch(a){this.error(a)}},first:function(){if(!this.frozen&&this.kifu)try{this.kifuReader.first(),this.update()}catch(a){this.error(a)}},goTo:function(a){if(!this.frozen&&
this.kifu){var b;"function"==typeof a&&(a=a.call(this));"number"==typeof a?(b=c.clone(this.kifuReader.path),b.m=a||0):b=a;try{this.kifuReader.goTo(b),this.update()}catch(f){this.error(f)}}},getGameInfo:function(){if(!this.kifu)return null;var a={},b;for(b in this.kifu.info)-1!=c.Kifu.infoList.indexOf(b)&&(c.Kifu.infoFormatters[b]?a[c.t(b)]=c.Kifu.infoFormatters[b](this.kifu.info[b]):a[c.t(b)]=c.filterHTML(this.kifu.info[b]));return a},setFrozen:function(a){this.frozen=a;this.dispatchEvent({type:this.frozen?
"frozen":"unfrozen",target:this})},appendTo:function(a){a.appendChild(this.element)},focus:function(){this.config.enableKeys&&this.setKeys(!0)},setKeys:function(b){document.onkeydown=b?a.bind(this):null},setWheel:function(a){!this._wheel_listener&&a?(this._wheel_listener=e.bind(this),a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.addEventListener(a,this._wheel_listener)):this._wheel_listener&&!a&&(a=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",this.element.removeEventListener(a,
this._wheel_listener),delete this._wheel_listener)},setCoordinates:function(a){!this.coordinates&&a?(this.board.setSection(-.5,-.5,-.5,-.5),this.board.addCustomObject(p)):this.coordinates&&!a&&(this.board.setSection(0,0,0,0),this.board.removeCustomObject(p));this.coordinates=a}};k.default={sgf:void 0,json:void 0,sgfFile:void 0,move:void 0,board:{},enableWheel:!0,lockScroll:!0,enableKeys:!0,rememberPath:!0,kifuLoaded:void 0,update:void 0,frozen:void 0,unfrozen:void 0,allowIllegalMoves:!1,markLastMove:!0};
c.Player=k;var f={"about-text":"<h1>WGo.js Player 2.0</h1><p>WGo.js Player is extension of WGo.js, HTML5 library for purposes of game of go. It allows to replay go game records and it has many features like score counting. It is also designed to be easily extendable.</p><p>WGo.js is open source licensed under <a href='http://en.wikipedia.org/wiki/MIT_License' target='_blank'>MIT license</a>. You can use and modify any code from this project.</p><p>You can find more information at <a href='http://wgo.waltheri.net/player' target='_blank'>wgo.waltheri.net/player</a></p><p>Copyright &copy; 2013 Jan Prokop</p>",
black:"Black",white:"White",DT:"Date",KM:"Komi",HA:"Handicap",AN:"Annotations",CP:"Copyright",GC:"Game comments",GN:"Game name",ON:"Fuseki",OT:"Overtime",TM:"Basic time",RE:"Result",RO:"Round",RU:"Rules",US:"Recorder",PC:"Place",EV:"Event",SO:"Source",none:"none",bpass:"Black passed.",wpass:"White passed."},q;for(q in f)c.i18n.en[q]=f[q]})(WGo);(function(c){var n=0,h=function(d,c,a){var b={};b.element=document.createElement("div");b.element.className="wgo-player-"+d;b.wrapper=document.createElement("div");b.wrapper.className="wgo-player-"+d+"-wrapper";b.element.appendChild(b.wrapper);c.appendChild(b.element);a||(b.element.style.display="none");return b},g=function(d){var c;if(c=this.currentLayout.layout?this.currentLayout.layout[d]:this.currentLayout[d]){this.regions[d].element.style.display="block";c.constructor!=Array&&(c=[c]);for(var a in c)this.components[c[a]]||
(this.components[c[a]]=new m.component[c[a]](this)),this.components[c[a]].appendTo(this.regions[d].wrapper),this.components[c[a]]._detachFromPlayer=!1}else this.regions[d].element.style.display="none"},m=c.extendClass(c.Player,function(d,e){this.config=e;for(var a in m.default)void 0===this.config[a]&&void 0!==m.default[a]&&(this.config[a]=m.default[a]);for(a in c.Player.default)void 0===this.config[a]&&void 0!==c.Player.default[a]&&(this.config[a]=c.Player.default[a]);this.element=d;this.element.innerHTML=
"";this.classes=(this.element.className?this.element.className+" ":"")+"wgo-player-main";this.element.className=this.classes;this.element.id||(this.element.id="wgo_"+n++);this.dom={};this.dom.center=document.createElement("div");this.dom.center.className="wgo-player-center";this.dom.board=document.createElement("div");this.dom.board.className="wgo-player-board";this.regions={};this.regions.left=h("left",this.element);this.element.appendChild(this.dom.center);this.regions.right=h("right",this.element);
this.regions.top=h("top",this.dom.center);this.dom.center.appendChild(this.dom.board);this.regions.bottom=h("bottom",this.dom.center);this.board=new c.Board(this.dom.board,this.config.board);this.init();this.components={};window.addEventListener("resize",function(){this.noresize||this.updateDimensions()}.bind(this));this.updateDimensions();this.initGame()});m.prototype.appendTo=function(c){c.appendChild(this.element);this.updateDimensions()};m.prototype.updateDimensions=function(){for(var c=window.getComputedStyle(this.element),
e=[];this.element.firstChild;)e.push(this.element.firstChild),this.element.removeChild(this.element.firstChild);for(var a=parseInt(c.width),b=parseInt(c.height),p=parseInt(c.maxHeight)||0,c=0;c<e.length;c++)this.element.appendChild(e[c]);if(a!=this.width||b!=this.height||p!=this.maxHeight){this.width=a;this.height=b;this.maxHeight=p;a:if(e=this.config.layout,e.constructor==Array){a=this.height||this.maxHeight;for(b=0;b<e.length;b++)if(!e[b].conditions||!(e[b].conditions.minWidth&&!(e[b].conditions.minWidth<=
this.width)||e[b].conditions.minHeight&&a&&!(e[b].conditions.minHeight<=a)||e[b].conditions.maxWidth&&!(e[b].conditions.maxWidth>=this.width)||e[b].conditions.maxHeight&&a&&!(e[b].conditions.maxHeight>=a)||e[b].conditions.custom&&!e[b].conditions.custom.call(this))){e=e[b];break a}e=void 0}if((this.currentLayout=e)&&this.lastLayout!=this.currentLayout){this.element.className=this.currentLayout.className?this.classes+" "+this.currentLayout.className:this.classes;for(var k in this.components)this.components[k]._detachFromPlayer=
!0;g.call(this,"left");g.call(this,"right");g.call(this,"top");g.call(this,"bottom");for(k in this.components)this.components[k]._detachFromPlayer&&this.components[k].element.parentNode&&this.components[k].element.parentNode.removeChild(this.components[k].element);this.lastLayout=this.currentLayout}e=this.dom.board.clientWidth;(k=this.height||this.maxHeight)&&(k-=this.regions.top.element.offsetHeight+this.regions.bottom.element.offsetHeight);k&&k<e?k!=this.board.height&&this.board.setHeight(k):e!=
this.board.width&&this.board.setWidth(e);e=k-e;0<e?(this.dom.board.style.height=k+"px",this.dom.board.style.paddingTop=e/2+"px"):(this.dom.board.style.height="auto",this.dom.board.style.paddingTop="0");this.regions.left.element.style.height=this.dom.center.offsetHeight+"px";this.regions.right.element.style.height=this.dom.center.offsetHeight+"px";for(c in this.components)this.components[c].updateDimensions&&this.components[c].updateDimensions()}};m.prototype.showMessage=function(d,e,a){this.info_overlay=
document.createElement("div");this.info_overlay.style.width=this.element.offsetWidth+"px";this.info_overlay.style.height=this.element.offsetHeight+"px";this.info_overlay.className="wgo-info-overlay";this.element.appendChild(this.info_overlay);var b=document.createElement("div");b.className="wgo-info-message";b.innerHTML=d;d=document.createElement("div");d.className="wgo-info-close";a||(d.innerHTML=c.t("BP:closemsg"));b.appendChild(d);this.info_overlay.appendChild(b);e?this.info_overlay.addEventListener("click",
function(a){e(a)}):a||this.info_overlay.addEventListener("click",function(a){this.hideMessage()}.bind(this));this.setFrozen(!0)};m.prototype.hideMessage=function(){this.element.removeChild(this.info_overlay);this.setFrozen(!1)};m.prototype.error=function(d){if(!c.ERROR_REPORT)throw d;switch(d.name){case "InvalidMoveError":this.showMessage("<h1>"+d.name+"</h1><p>"+d.message+'</p><p>If this message isn\'t correct, please report it by clicking <a href="#">here</a>, otherwise contact maintainer of this site.</p>');
break;case "FileError":this.showMessage("<h1>"+d.name+"</h1><p>"+d.message+"</p><p>Please contact maintainer of this site. Note: it is possible to read files only from this host.</p>");break;default:this.showMessage("<h1>"+d.name+"</h1><p>"+d.message+"</p><pre>"+d.stacktrace+'</pre><p>Please contact maintainer of this site. You can also report it <a href="#">here</a>.</p>')}};m.component={};m.layouts={one_column:{top:[],bottom:[]},no_comment:{top:[],bottom:[]},right_top:{top:[],right:[]},right:{right:[]},
minimal:{bottom:[]}};m.dynamicLayout=[{conditions:{minWidth:650},layout:m.layouts.right_top,className:"wgo-twocols wgo-large"},{conditions:{minWidth:550,minHeight:600},layout:m.layouts.one_column,className:"wgo-medium"},{conditions:{minWidth:350},layout:m.layouts.no_comment,className:"wgo-small"},{layout:m.layouts.no_comment,className:"wgo-xsmall"}];m.default={layout:m.dynamicLayout};c.i18n.en["BP:closemsg"]="click anywhere to close this window";m.attributes={"data-wgo":function(c){c&&("("==c[0]?
this.sgf=c:this.sgfFile=c)},"data-wgo-board":function(c){this.board=eval("({"+c+"})")},"data-wgo-onkifuload":function(c){this.kifuLoaded=new Function(c)},"data-wgo-onupdate":function(c){this.update=new Function(c)},"data-wgo-onfrozen":function(c){this.frozen=new Function(c)},"data-wgo-onunfrozen":function(c){this.unfrozen=new Function(c)},"data-wgo-layout":function(c){this.layout=eval("({"+c+"})")},"data-wgo-enablewheel":function(c){"false"==c.toLowerCase()&&(this.enableWheel=!1)},"data-wgo-lockscroll":function(c){"false"==
c.toLowerCase()&&(this.lockScroll=!1)},"data-wgo-enablekeys":function(c){"false"==c.toLowerCase()&&(this.enableKeys=!1)},"data-wgo-rememberpath":function(c){"false"==c.toLowerCase()&&(this.rememberPath=!1)},"data-wgo-allowillegal":function(c){"false"!=c.toLowerCase()&&(this.allowIllegalMoves=!0)},"data-wgo-move":function(c){var e=parseInt(c);this.move=e?e:eval("({"+c+"})")},"data-wgo-marklastmove":function(c){"false"==c.toLowerCase()&&(this.markLastMove=!1)},"data-wgo-diagram":function(c){c&&("("==
c[0]?this.sgf=c:this.sgfFile=c,this.enableWheel=this.enableKeys=this.markLastMove=!1,this.layout=eval("({top: [], right: [], left: [], bottom: []})"))}};c.BasicPlayer=m;window.addEventListener("load",function(){for(var c=document.querySelectorAll("[data-wgo],[data-wgo-diagram]"),e=0;e<c.length;e++){for(var a=c[e],b=void 0,g=void 0,b=void 0,g={},k=0;k<a.attributes.length;k++)b=a.attributes[k],m.attributes[b.name]&&m.attributes[b.name].call(g,b.value,b.name);b=new m(a,g);a._wgo_player=b}})})(WGo);(function(c,n){var h=function(){this.element=document.createElement("div")};h.prototype={constructor:h,appendTo:function(c){c.appendChild(this.element)},getWidth:function(){var c=window.getComputedStyle(this.element);return parseInt(c.width)},getHeight:function(){var c=window.getComputedStyle(this.element);return parseInt(c.height)},updateDimensions:function(){}};c.BasicPlayer.component.Component=h})(WGo);(function(){var c=function(a){this[a]={};var b=this[a];b.box=document.createElement("div");b.box.className="wgo-box-wrapper wgo-player-wrapper wgo-"+a;b.name=document.createElement("div");b.name.className="wgo-box-title";b.name.innerHTML=a;b.box.appendChild(b.name);a=document.createElement("div");a.className="wgo-player-info";b.box.appendChild(a);b.info={};b.info.rank=n("rank");b.info.rank.val.innerHTML="-";b.info.caps=n("caps");b.info.caps.val.innerHTML="0";b.info.time=n("time");b.info.time.val.innerHTML=
"--:--";a.appendChild(b.info.rank.wrapper);a.appendChild(b.info.caps.wrapper);a.appendChild(b.info.time.wrapper)},n=function(a){var b={};b.wrapper=document.createElement("div");b.wrapper.className="wgo-player-info-box-wrapper";b.box=document.createElement("div");b.box.className="wgo-player-info-box";b.wrapper.appendChild(b.box);b.title=document.createElement("div");b.title.className="wgo-player-info-title";b.title.innerHTML=WGo.t(a);b.box.appendChild(b.title);b.val=document.createElement("div");b.val.className=
"wgo-player-info-value";b.box.appendChild(b.val);return b},h=function(a){a=a.kifu.info||{};a.black?(this.black.name.innerHTML=WGo.filterHTML(a.black.name)||WGo.t("black"),this.black.info.rank.val.innerHTML=WGo.filterHTML(a.black.rank)||"-"):(this.black.name.innerHTML=WGo.t("black"),this.black.info.rank.val.innerHTML="-");a.white?(this.white.name.innerHTML=WGo.filterHTML(a.white.name)||WGo.t("white"),this.white.info.rank.val.innerHTML=WGo.filterHTML(a.white.rank)||"-"):(this.white.name.innerHTML=WGo.t("white"),
this.white.info.rank.val.innerHTML="-");this.black.info.caps.val.innerHTML="0";this.white.info.caps.val.innerHTML="0";a.TM?(this.setPlayerTime("black",a.TM),this.setPlayerTime("white",a.TM)):(this.black.info.time.val.innerHTML="--:--",this.white.info.time.val.innerHTML="--:--");this.updateDimensions()},g=function(a){var b,c;a.style.fontSize?(c=parseInt(a.style.fontSize),a.style.fontSize="",b=window.getComputedStyle(a),b=parseInt(b.fontSize),a.style.fontSize=c+"px"):(b=window.getComputedStyle(a),b=
c=parseInt(b.fontSize));if(!(c==b&&a.scrollHeight<=a.offsetHeight))if(a.scrollHeight>a.offsetHeight)for(c-=2;a.scrollHeight>a.offsetHeight&&1<c;)a.style.fontSize=c+"px",c-=2;else if(c<b){for(c+=2;a.scrollHeight<=a.offsetHeight&&c<=b;)a.style.fontSize=c+"px",c+=2;a.scrollHeight>a.offsetHeight&&(a.style.fontSize=c-4+"px")}},m=function(a){a.node.BL&&this.setPlayerTime("black",a.node.BL);a.node.WL&&this.setPlayerTime("white",a.node.WL);void 0!==a.position.capCount.black&&(this.black.info.caps.val.innerHTML=
a.position.capCount.black);void 0!==a.position.capCount.white&&(this.white.info.caps.val.innerHTML=a.position.capCount.white)},d=WGo.extendClass(WGo.BasicPlayer.component.Component,function(a){this.super(a);this.element.className="wgo-infobox";c.call(this,"white");c.call(this,"black");this.element.appendChild(this.white.box);this.element.appendChild(this.black.box);a.addEventListener("kifuLoaded",h.bind(this));a.addEventListener("update",m.bind(this))});d.prototype.setPlayerTime=function(a,b){var c=
Math.floor(b/60),d=Math.round(b)%60;this[a].info.time.val.innerHTML=c+":"+(10>d?"0"+d:d)};d.prototype.updateDimensions=function(){g(this.black.name);g(this.white.name)};var e=WGo.BasicPlayer.layouts;e.right_top.right.push("InfoBox");e.right.right.push("InfoBox");e.one_column.top.push("InfoBox");e.no_comment.top.push("InfoBox");WGo.i18n.en.rank="Rank";WGo.i18n.en.caps="Caps";WGo.i18n.en.time="Time";WGo.BasicPlayer.component.InfoBox=d})(WGo);(function(c,n){var h=function(a){var b,c;b=a.charCodeAt(0)-97;0>b&&(b+=32);7<b&&b--;c=a.charCodeAt(1)-48;2<a.length&&(c=10*c+(a.charCodeAt(2)-48));c=this.kifuReader.game.size-c;this._tmp_mark={type:"MA",x:b,y:c};this.board.addObject(this._tmp_mark)},g=function(){this.board.removeObject(this._tmp_mark);delete this._tmp_mark},m=function(a,b){for(var c in a)a[c].className&&"wgo-move-link"==a[c].className?(a[c].addEventListener("mouseover",h.bind(b,a[c].innerHTML)),a[c].addEventListener("mouseout",g.bind(b))):
a[c].childNodes&&a[c].childNodes.length&&m(a[c].childNodes,b)},d=function(a,b){var d='<div class="wgo-info-list">';b&&(d+='<div class="wgo-info-title">'+c.t("gameinfo")+"</div>");for(var e in a)d+='<div class="wgo-info-item"><span class="wgo-info-label">'+e+'</span><span class="wgo-info-value">'+a[e]+"</span></div>";return d+"</div>"},e=c.extendClass(c.BasicPlayer.component.Component,function(a){this.super(a);this.player=a;this.element.className="wgo-commentbox";this.box=document.createElement("div");
this.box.className="wgo-box-wrapper wgo-comments-wrapper";this.element.appendChild(this.box);this.comments_title=document.createElement("div");this.comments_title.className="wgo-box-title";this.comments_title.innerHTML=c.t("comments");this.box.appendChild(this.comments_title);this.comments=document.createElement("div");this.comments.className="wgo-comments-content";this.box.appendChild(this.comments);this.help=document.createElement("div");this.help.className="wgo-help";this.help.style.display="none";
this.comments.appendChild(this.help);this.notification=document.createElement("div");this.notification.className="wgo-notification";this.notification.style.display="none";this.comments.appendChild(this.notification);this.comment_text=document.createElement("div");this.comment_text.className="wgo-comment-text";this.comments.appendChild(this.comment_text);a.addEventListener("kifuLoaded",function(b){b.kifu.hasComments()?(this.comments_title.innerHTML=c.t("comments"),this.element.className="wgo-commentbox",
this._update=function(a){this.setComments(a)}.bind(this),a.addEventListener("update",this._update)):(this.comments_title.innerHTML=c.t("gameinfo"),this.element.className="wgo-commentbox wgo-gameinfo",this._update&&(a.removeEventListener("update",this._update),delete this._update),this.comment_text.innerHTML=d(b.target.getGameInfo()))}.bind(this));a.notification=function(a){a?(this.notification.style.display="block",this.notification.innerHTML=a,this.is_notification=!0):(this.notification.style.display=
"none",this.is_notification=!1);this.comment_text.style.display=this.is_notification||this.is_help?"none":"block"}.bind(this);a.help=function(a){a?(this.help.style.display="block",this.help.innerHTML=a,this.is_help=!0):(this.help.style.display="none",this.is_help=!1);this.comment_text.style.display=this.is_notification||this.is_help?"none":"block"}.bind(this)});e.prototype.setComments=function(a){this.player._tmp_mark&&g.call(this.player);var b="";a.node.parent||(b=d(a.target.getGameInfo(),!0));this.comment_text.innerHTML=
b+this.getCommentText(a.node.comment,this.player.config.formatNicks,this.player.config.formatMoves);this.player.config.formatMoves&&this.comment_text.childNodes&&this.comment_text.childNodes.length&&m(this.comment_text.childNodes,this.player)};e.prototype.getCommentText=function(a,b,d){return a?(a="<p>"+c.filterHTML(a).replace(/\n/g,"</p><p>")+"</p>",b&&(a=a.replace(/(<p>)([^:]{3,}:)\s/g,'<p><span class="wgo-comments-nick">$2</span> ')),d&&(a=a.replace(/\b[a-zA-Z]1?\d\b/g,'<a href="javascript:void(0)" class="wgo-move-link">$&</a>')),
a):""};c.BasicPlayer.default.formatNicks=!0;c.BasicPlayer.default.formatMoves=!0;c.BasicPlayer.attributes["data-wgo-formatnicks"]=function(a){"false"==a.toLowerCase()&&(this.formatNicks=!1)};c.BasicPlayer.attributes["data-wgo-formatmoves"]=function(a){"false"==a.toLowerCase()&&(this.formatMoves=!1)};c.BasicPlayer.layouts.right_top.right.push("CommentBox");c.BasicPlayer.layouts.right.right.push("CommentBox");c.BasicPlayer.layouts.one_column.bottom.push("CommentBox");c.i18n.en.comments="Comments";c.i18n.en.gameinfo=
"Game info";c.BasicPlayer.component.CommentBox=e})(WGo);(function(c,n){var h=c.extendClass(c.BasicPlayer.component.Component,function(a){this.super(a);this.widgets=[];this.element.className="wgo-player-control";this.iconBar=document.createElement("div");this.iconBar.className="wgo-control-wrapper";this.element.appendChild(this.iconBar);var b,c;for(c in h.widgets)b=new h.widgets[c].constructor(a,h.widgets[c].args),b.appendTo(this.iconBar),this.widgets.push(b)});h.prototype.updateDimensions=function(){this.element.className=340>this.element.clientWidth?
"wgo-player-control wgo-340":440>this.element.clientWidth?"wgo-player-control wgo-440":"wgo-player-control"};var g=c.BasicPlayer.control={},m=function(a){a.node.parent||this.disabled?a.node.parent&&this.disabled&&this.enable():this.disable()},d=function(a){a.node.children.length||this.disabled?a.node.children.length&&this.disabled&&this.enable():this.disable()},e=function(a){(this._disabled=this.disabled)||this.disable()},a=function(a){this._disabled||this.enable();delete this._disabled};g.Widget=
function(a,b){this.element=this.element||document.createElement(b.type||"div");this.element.className="wgo-widget-"+b.name;this.init(a,b)};g.Widget.prototype={constructor:g.Widget,init:function(a,b){b&&(b.disabled&&this.disable(),b.init&&b.init.call(this,a))},appendTo:function(a){a.appendChild(this.element)},disable:function(){this.disabled=!0;-1==this.element.className.search("wgo-disabled")&&(this.element.className+=" wgo-disabled")},enable:function(){this.disabled=!1;this.element.className=this.element.className.replace(" wgo-disabled",
"");this.element.disabled=""}};g.Group=c.extendClass(g.Widget,function(a,b){this.element=document.createElement("div");this.element.className="wgo-ctrlgroup wgo-ctrlgroup-"+b.name;var c,d;for(d in b.widgets)c=new b.widgets[d].constructor(a,b.widgets[d].args),c.appendTo(this.element)});g.Clickable=c.extendClass(g.Widget,function(a,b){this.super(a,b)});g.Clickable.prototype.init=function(a,b){var c,d=this;c=b.togglable?function(){d.disabled||(b.click.call(d,a)?d.select():d.unselect())}:function(){d.disabled||
b.click.call(d,a)};this.element.addEventListener("click",c);this.element.addEventListener("touchstart",function(a){a.preventDefault();c();b.multiple&&(d._touch_i=0,d._touch_int=window.setInterval(function(){500<d._touch_i&&c();d._touch_i+=100},100));return!1});b.multiple&&this.element.addEventListener("touchend",function(a){window.clearInterval(d._touch_int)});b.disabled&&this.disable();b.init&&b.init.call(this,a)};g.Clickable.prototype.select=function(){this.selected=!0;-1==this.element.className.search("wgo-selected")&&
(this.element.className+=" wgo-selected")};g.Clickable.prototype.unselect=function(){this.selected=!1;this.element.className=this.element.className.replace(" wgo-selected","")};g.Button=c.extendClass(g.Clickable,function(a,b){var d=this.element=document.createElement("button");d.className="wgo-button wgo-button-"+b.name;d.title=c.t(b.name);this.init(a,b)});g.Button.prototype.disable=function(){g.Button.prototype.super.prototype.disable.call(this);this.element.disabled="disabled"};g.Button.prototype.enable=
function(){g.Button.prototype.super.prototype.enable.call(this);this.element.disabled=""};g.MenuItem=c.extendClass(g.Clickable,function(a,b){var d=this.element=document.createElement("div");d.className="wgo-menu-item wgo-menu-item-"+b.name;d.title=c.t(b.name);d.innerHTML=d.title;this.init(a,b)});g.MoveNumber=c.extendClass(g.Widget,function(a){this.element=document.createElement("form");this.element.className="wgo-player-mn-wrapper";var b=this.move=document.createElement("input");b.type="text";b.value=
"0";b.maxlength=3;b.className="wgo-player-mn-value";this.element.appendChild(b);this.element.onsubmit=b.onchange=function(a){a.goTo(this.getValue());return!1}.bind(this,a);a.addEventListener("update",function(a){this.setValue(a.path.m)}.bind(this));a.addEventListener("kifuLoaded",this.enable.bind(this));a.addEventListener("frozen",this.disable.bind(this));a.addEventListener("unfrozen",this.enable.bind(this))});g.MoveNumber.prototype.disable=function(){g.MoveNumber.prototype.super.prototype.disable.call(this);
this.move.disabled="disabled"};g.MoveNumber.prototype.enable=function(){g.MoveNumber.prototype.super.prototype.enable.call(this);this.move.disabled=""};g.MoveNumber.prototype.setValue=function(a){this.move.value=a};g.MoveNumber.prototype.getValue=function(){return parseInt(this.move.value)};var b=function(a){if(a._menu_tmp)delete a._menu_tmp;else{if(!a.menu){a.menu=document.createElement("div");a.menu.className="wgo-player-menu";a.menu.style.position="absolute";a.menu.style.display="none";this.element.parentElement.appendChild(a.menu);
var c,d;for(d in h.menu)c=new h.menu[d].constructor(a,h.menu[d].args,!0),c.appendTo(a.menu)}if("none"!=a.menu.style.display)return a.menu.style.display="none",document.removeEventListener("click",a._menu_ev),delete a._menu_ev,this.unselect(),!1;a.menu.style.display="block";c=this.element.offsetTop;d=this.element.offsetLeft;this.element.parentElement.parentElement.parentElement.parentElement==a.regions.bottom.wrapper?(a.menu.style.left=d+"px",a.menu.style.top=c-a.menu.offsetHeight+1+"px"):(a.menu.style.left=
d+"px",a.menu.style.top=c+this.element.offsetHeight+"px");a._menu_ev=b.bind(this,a);a._menu_tmp=!0;document.addEventListener("click",a._menu_ev);return!0}};h.menu=[{constructor:g.MenuItem,args:{name:"switch-coo",togglable:!0,click:function(a){a.setCoordinates(!a.coordinates);return a.coordinates},init:function(a){a.coordinates&&this.select()}}}];h.widgets=[{constructor:g.Group,args:{name:"left",widgets:[{constructor:g.Button,args:{name:"menu",togglable:!0,click:b}}]}},{constructor:g.Group,args:{name:"right",
widgets:[{constructor:g.Button,args:{name:"about",click:function(a){a.showMessage(c.t("about-text"))}}}]}},{constructor:g.Group,args:{name:"control",widgets:[{constructor:g.Button,args:{name:"first",disabled:!0,init:function(b){b.addEventListener("update",m.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.first()}}},{constructor:g.Button,args:{name:"multiprev",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",
m.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){var b=c.clone(a.kifuReader.path);b.m-=10;a.goTo(b)}}},{constructor:g.Button,args:{name:"previous",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",m.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.previous()}}},{constructor:g.MoveNumber},{constructor:g.Button,args:{name:"next",disabled:!0,multiple:!0,
init:function(b){b.addEventListener("update",d.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.next()}}},{constructor:g.Button,args:{name:"multinext",disabled:!0,multiple:!0,init:function(b){b.addEventListener("update",d.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){var b=c.clone(a.kifuReader.path);b.m+=10;a.goTo(b)}}},{constructor:g.Button,args:{name:"last",
disabled:!0,init:function(b){b.addEventListener("update",d.bind(this));b.addEventListener("frozen",e.bind(this));b.addEventListener("unfrozen",a.bind(this))},click:function(a){a.last()}}}]}}];var p=c.BasicPlayer.layouts;p.right_top.top.push("Control");p.right.right.push("Control");p.one_column.top.push("Control");p.no_comment.bottom.push("Control");p.minimal.bottom.push("Control");var p={about:"About",first:"First",multiprev:"10 moves back",previous:"Previous",next:"Next",multinext:"10 moves forward",
last:"Last","switch-coo":"Display coordinates",menu:"Menu"},k;for(k in p)c.i18n.en[k]=p[k];c.BasicPlayer.component.Control=h})(WGo);(function(c){var n=function(c,h){this.player.frozen||this._lastX==c&&this._lastY==h||(this._lastX=c,this._lastY=h,this._last_mark&&this.board.removeObject(this._last_mark),-1!=c&&-1!=h&&this.player.kifuReader.game.isValid(c,h)?(this._last_mark={type:"outline",x:c,y:h,c:this.player.kifuReader.game.turn},this.board.addObject(this._last_mark)):delete this._last_mark)},h=function(){this._last_mark&&(this.board.removeObject(this._last_mark),delete this._last_mark,delete this._lastX,delete this._lastY)};
c.Player.Editable={};c.Player.Editable=function(c,h){this.player=c;this.board=h;this.editMode=!1};c.Player.Editable.prototype.set=function(g){if(!this.editMode&&g)this.originalReader=this.player.kifuReader,this.player.kifuReader=new c.KifuReader(this.player.kifu.clone(),this.originalReader.rememberPath,this.originalReader.allow_illegal,this.originalReader.allow_illegal),this.player.kifuReader.goTo(this.originalReader.path),this._ev_click=this._ev_click||this.play.bind(this),this._ev_move=this._ev_move||
n.bind(this),this._ev_out=this._ev_out||h.bind(this),this.board.addEventListener("click",this._ev_click),this.board.addEventListener("mousemove",this._ev_move),this.board.addEventListener("mouseout",this._ev_out),this.editMode=!0;else if(this.editMode&&!g){this.originalReader.goTo(this.player.kifuReader.path);g=this.originalReader;for(var m=this.player.kifuReader.getPosition(),d=this.originalReader.getPosition(),e=m.size,a=[],b=[],p=0;p<e*e;p++)m.schema[p]&&!d.schema[p]?b.push({x:Math.floor(p/e),
y:p%e}):m.schema[p]!=d.schema[p]&&a.push({x:Math.floor(p/e),y:p%e,c:d.schema[p]});g.change={add:a,remove:b};this.player.kifuReader=this.originalReader;this.player.update(!0);this.board.removeEventListener("click",this._ev_click);this.board.removeEventListener("mousemove",this._ev_move);this.board.removeEventListener("mouseout",this._ev_out);this.editMode=!1}};c.Player.Editable.prototype.play=function(g,h){!this.player.frozen&&this.player.kifuReader.game.isValid(g,h)&&(this.player.kifuReader.node.appendChild(new c.KNode({move:{x:g,
y:h,c:this.player.kifuReader.game.turn},edited:!0})),this.player.next(this.player.kifuReader.node.children.length-1))};c.BasicPlayer&&c.BasicPlayer.component.Control&&c.BasicPlayer.component.Control.menu.push({constructor:c.BasicPlayer.control.MenuItem,args:{name:"editmode",togglable:!0,click:function(g){this._editable=this._editable||new c.Player.Editable(g,g.board);this._editable.set(!this._editable.editMode);return this._editable.editMode},init:function(c){var h=this;c.addEventListener("frozen",
function(c){(h._disabled=h.disabled)||h.disable()});c.addEventListener("unfrozen",function(c){h._disabled||h.enable();delete h._disabled})}}});c.i18n.en.editmode="Edit mode"})(WGo);(function(c){var n=function(c,e,a,b){this.originalPosition=c;this.position=c.clone();this.board=e;this.komi=a;this.output=b},h=n.state={UNKNOWN:0,BLACK_STONE:1,WHITE_STONE:-1,BLACK_CANDIDATE:2,WHITE_CANDIDATE:-2,BLACK_NEUTRAL:3,WHITE_NEUTRAL:-3,NEUTRAL:4},g=function(c,e,a,b,h){var k=c.get(e,a);void 0!==k&&k!=b&&k!=h&&(c.set(e,a,b),g(c,e-1,a,b,h),g(c,e,a-1,b,h),g(c,e+1,a,b,h),g(c,e,a+1,b,h))},m=function(c,e,a,b,g){var h=e.get(a,b);c.get(a,b)!=h&&(c.set(a,b,h),m(c,e,a-1,b,g),m(c,e,a,b-1,g),m(c,e,a+
1,b,g),m(c,e,a,b+1,g))};n.prototype.start=function(){this.calculate();this.saved_state=this.board.getState();this.displayScore();this._click=function(d,e){var a=this.originalPosition.get(d,e);a==c.W?this.position.get(d,e)==h.WHITE_STONE?g(this.position,d,e,h.BLACK_CANDIDATE,h.BLACK_STONE):(m(this.position,this.originalPosition,d,e,h.BLACK_STONE),this.calculate()):a==c.B?this.position.get(d,e)==h.BLACK_STONE?g(this.position,d,e,h.WHITE_CANDIDATE,h.WHITE_STONE):(m(this.position,this.originalPosition,
d,e,h.WHITE_STONE),this.calculate()):(a=this.position.get(d,e),a==h.BLACK_CANDIDATE?this.position.set(d,e,h.BLACK_NEUTRAL):a==h.WHITE_CANDIDATE?this.position.set(d,e,h.WHITE_NEUTRAL):a==h.BLACK_NEUTRAL?this.position.set(d,e,h.BLACK_CANDIDATE):a==h.WHITE_NEUTRAL&&this.position.set(d,e,h.WHITE_CANDIDATE));this.board.restoreState({objects:c.clone(this.saved_state.objects)});this.displayScore()}.bind(this);this.board.addEventListener("click",this._click)};n.prototype.end=function(){this.board.restoreState({objects:c.clone(this.saved_state.objects)});
this.board.removeEventListener("click",this._click)};n.prototype.displayScore=function(){for(var d=[],e=[],a=[],b=[],g=[],k=0;k<this.position.size;k++)for(var f=0;f<this.position.size;f++)s=this.position.get(k,f),t=this.originalPosition.get(k,f),s==h.BLACK_CANDIDATE?d.push({x:k,y:f,type:"mini",c:c.B}):s==h.WHITE_CANDIDATE?e.push({x:k,y:f,type:"mini",c:c.W}):s==h.NEUTRAL&&a.push({x:k,y:f}),t==c.W&&s!=h.WHITE_STONE?g.push({x:k,y:f,type:"outline",c:c.W}):t==c.B&&s!=h.BLACK_STONE&&b.push({x:k,y:f,type:"outline",
c:c.B});for(k=0;k<b.length;k++)this.board.removeObjectsAt(b[k].x,b[k].y);for(k=0;k<g.length;k++)this.board.removeObjectsAt(g[k].x,g[k].y);this.board.addObject(g);this.board.addObject(b);this.board.addObject(d);this.board.addObject(e);a="<p style='font-weight: bold;'>"+c.t("RE")+"</p>";k=d.length+g.length+this.originalPosition.capCount.black;f=e.length+b.length+this.originalPosition.capCount.white+parseFloat(this.komi);a+="<p>"+c.t("black")+": "+d.length+" + "+(g.length+this.originalPosition.capCount.black)+
" = "+k+"</br>";a+=c.t("white")+": "+e.length+" + "+(b.length+this.originalPosition.capCount.white)+" + "+this.komi+" = "+f+"</p>";a=k>f?a+("<p style='font-weight: bold;'>"+c.t("bwin",k-f)+"</p>"):a+("<p style='font-weight: bold;'>"+c.t("wwin",f-k)+"</p>");this.output(a)};n.prototype.calculate=function(){var c,e,a,b,g,k;c=this.position;for(k=!0;k;){k=!1;for(var f=0;f<c.size;f++)for(var m=0;m<c.size;m++)if(e=c.get(m,f),e==h.UNKNOWN||e==h.BLACK_CANDIDATE||e==h.WHITE_CANDIDATE){a=[c.get(m-1,f),c.get(m,
f-1),c.get(m+1,f),c.get(m,f+1)];g=b=!1;for(var l=0;4>l;l++)a[l]==h.BLACK_STONE||a[l]==h.BLACK_CANDIDATE?b=!0:a[l]==h.WHITE_STONE||a[l]==h.WHITE_CANDIDATE?g=!0:a[l]==h.NEUTRAL&&(g=b=!0);a=!1;b&&g?a=h.NEUTRAL:b?a=h.BLACK_CANDIDATE:g&&(a=h.WHITE_CANDIDATE);a&&e!=a&&(k=!0,c.set(m,f,a))}}};c.ScoreMode=n;c.BasicPlayer&&c.BasicPlayer.component.Control&&c.BasicPlayer.component.Control.menu.push({constructor:c.BasicPlayer.control.MenuItem,args:{name:"scoremode",togglable:!0,click:function(d){if(this.selected)return d.setFrozen(!1),
this._score_mode.end(),delete this._score_mode,d.notification(),d.help(),!1;d.setFrozen(!0);d.help("<p>"+c.t("help_score")+"</p>");this._score_mode=new c.ScoreMode(d.kifuReader.game.position,d.board,d.kifu.info.KM||.5,d.notification);this._score_mode.start();return!0}}});c.i18n.en.scoremode="Count score";c.i18n.en.score="Score";c.i18n.en.bwin="Black wins by $ points.";c.i18n.en.wwin="White wins by $ points.";c.i18n.en.help_score="Click on stones to mark them dead or alive. You can also set and unset territory points by clicking on them. Territories must be completely bordered."})(WGo);(function(c,n){var h={active:!0,query:{}},g=function(c){try{h.query=JSON.parse('{"'+window.location.hash.substr(1).replace("=",'":')+"}")}catch(e){h.query={}}};window.addEventListener("hashchange",function(){if(""!=window.location.hash&&h.active){g();for(var c in h.query){var e=document.getElementById(c);e&&e._wgo_player&&e._wgo_player.goTo(m)}}});window.addEventListener("DOMContentLoaded",function(){""!=window.location.hash&&h.active&&g()});window.addEventListener("load",function(){if(""!=window.location.hash&&
h.active)for(var c in h.query){var e=document.getElementById(c);if(e&&e._wgo_player){e.scrollIntoView();break}}});var m=function(){if(h.query[this.element.id])return h.query[this.element.id].goto};c.Player.default.move=m;c.BasicPlayer&&c.BasicPlayer.component.Control&&c.BasicPlayer.component.Control.menu.push({constructor:c.BasicPlayer.control.MenuItem,args:{name:"permalink",click:function(d){var e=location.href.split("#")[0]+"#"+d.element.id+'={"goto":'+JSON.stringify(d.kifuReader.path)+"}";d.showMessage("<h1>"+
c.t("permalink")+'</h1><p><input class="wgo-permalink" type="text" value=\''+e+'\' onclick="this.select(); event.stopPropagation()"/></p>')}}});c.Player.permalink=h;c.i18n.en.permalink="Permanent link"})(WGo);
